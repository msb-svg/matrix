<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <title>Decision Matrix Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;family=Rajdhani:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes matrixRain {
      0% { transform: translateY(-100%); opacity: 1; }
      100% { transform: translateY(100vh); opacity: 0; }
    }
    
    @keyframes glitch {
      0%, 100% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 65, 0.3); }
      50% { box-shadow: 0 0 40px rgba(0, 255, 65, 0.6), 0 0 60px rgba(0, 255, 65, 0.3); }
    }
    
    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes typewriter {
      from { width: 0; }
      to { width: 100%; }
    }
    
    @keyframes blink {
      50% { border-color: transparent; }
    }
    
    @keyframes coinFlip {
      0% { transform: rotateY(0deg) scale(1); }
      25% { transform: rotateY(450deg) scale(1.2); }
      50% { transform: rotateY(900deg) scale(1); }
      75% { transform: rotateY(1350deg) scale(1.2); }
      100% { transform: rotateY(1800deg) scale(1); }
    }
    
    @keyframes resultReveal {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      50% { transform: scale(1.3) rotate(10deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    @keyframes progressPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .matrix-char {
      position: absolute;
      color: #00ff41;
      font-family: 'Orbitron', monospace;
      font-size: 14px;
      animation: matrixRain linear infinite;
      text-shadow: 0 0 10px #00ff41;
      pointer-events: none;
    }
    
    .glitch-text:hover {
      animation: glitch 0.3s ease-in-out;
    }
    
    .card-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .scanline {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(transparent, rgba(0, 255, 65, 0.2), transparent);
      animation: scanline 3s linear infinite;
      pointer-events: none;
    }
    
    .floating {
      animation: float 3s ease-in-out infinite;
    }
    
    .coin-flip {
      animation: coinFlip 1.5s ease-out forwards;
    }
    
    .result-reveal {
      animation: resultReveal 0.8s ease-out forwards;
    }
    
    .progress-pulse {
      animation: progressPulse 1s ease-in-out infinite;
    }
    
    .btn-matrix {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .btn-matrix::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 65, 0.3), transparent);
      transform: rotate(45deg);
      transition: all 0.5s ease;
      opacity: 0;
    }
    
    .btn-matrix:hover::before {
      opacity: 1;
      left: 100%;
    }
    
    .btn-matrix:active {
      transform: scale(0.95);
    }
    
    .terminal-text {
      font-family: 'Rajdhani', sans-serif;
    }
    
    .score-counter {
      transition: all 0.3s ease;
    }
    
    .score-counter.bump {
      transform: scale(1.2);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 overflow-hidden">
  <div id="app-container" class="h-full w-full relative flex items-center justify-center overflow-auto" style="background: linear-gradient(135deg, #0a0a0a 0%, #0d1f0d 50%, #0a0a0a 100%);"><!-- Matrix Rain Background -->
   <div id="matrix-rain" class="absolute inset-0 overflow-hidden pointer-events-none"></div><!-- Main Card -->
   <div class="relative z-10 w-full max-w-lg mx-4 my-8">
    <div id="game-card" class="card-glow relative bg-black/80 backdrop-blur-sm rounded-2xl p-8 border-2 border-green-500/50"><!-- Scanline Effect -->
     <div class="scanline"></div><!-- Header -->
     <div class="text-center mb-6">
      <h1 id="title" class="glitch-text text-2xl md:text-3xl font-bold mb-2" style="font-family: 'Orbitron', monospace; color: #00ff41; text-shadow: 0 0 20px #00ff41;">DECISION MATRIX</h1>
      <div class="terminal-text text-green-400/70 text-sm tracking-wider">
       SYSTEM v2.0 â€¢ NEURAL LINK ACTIVE
      </div>
     </div><!-- Player Info -->
     <div id="player-info" class="flex items-center justify-between mb-6 p-3 rounded-lg bg-green-900/20 border border-green-500/30">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-black font-bold" style="font-family: 'Orbitron', monospace;"><span id="player-initial">P</span>
       </div>
       <div>
        <div id="player-name" class="terminal-text text-green-300 font-semibold">
         Player
        </div>
        <div class="text-green-500/60 text-xs">
         CLEARANCE: LEVEL 5
        </div>
       </div>
      </div>
      <div class="text-right">
       <div class="text-green-500/60 text-xs">
        SCORE
       </div>
       <div id="score" class="score-counter text-2xl font-bold text-green-400" style="font-family: 'Orbitron', monospace;">
        0
       </div>
      </div>
     </div><!-- Progress Bar -->
     <div class="mb-6">
      <div class="flex justify-between text-xs text-green-500/60 mb-1 terminal-text"><span>PROGRESS</span> <span id="progress-text">0/5</span>
      </div>
      <div class="h-2 bg-green-900/30 rounded-full overflow-hidden">
       <div id="progress-bar" class="h-full bg-gradient-to-r from-green-600 to-green-400 transition-all duration-500 ease-out" style="width: 0%;"></div>
      </div>
     </div><!-- Timer -->
     <div id="timer-container" class="hidden mb-6">
      <div class="flex items-center justify-center gap-2">
       <svg class="w-5 h-5 text-yellow-400 progress-pulse" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
       </svg><span id="timer-text" class="text-yellow-400 font-bold" style="font-family: 'Orbitron', monospace;">15</span> <span class="text-yellow-400/60 text-sm terminal-text">SECONDS REMAINING</span>
      </div>
      <div class="mt-2 h-1 bg-yellow-900/30 rounded-full overflow-hidden">
       <div id="timer-bar" class="h-full bg-gradient-to-r from-yellow-600 to-yellow-400 transition-all duration-1000 linear" style="width: 100%;"></div>
      </div>
     </div><!-- Question Area -->
     <div id="question-area" class="text-center mb-6 floating">
      <div id="question-icon" class="text-5xl mb-4">
       ðŸŽ®
      </div>
      <div id="question-text" class="terminal-text text-xl md:text-2xl text-green-100 font-semibold leading-relaxed">
       Ready to enter the Decision Matrix?
      </div>
     </div><!-- Note -->
     <div id="note-container" class="hidden mb-6 p-3 rounded-lg bg-green-900/20 border-l-4 border-green-500">
      <div class="flex items-start gap-2"><span class="text-green-400">ðŸ’¡</span>
       <p id="note-text" class="terminal-text text-green-300/80 text-sm"></p>
      </div>
     </div><!-- Coin Container -->
     <div id="coin-container" class="hidden flex justify-center mb-6">
      <div id="coin" class="w-24 h-24 rounded-full bg-gradient-to-br from-yellow-400 via-yellow-500 to-yellow-600 flex items-center justify-center text-4xl shadow-lg shadow-yellow-500/30 cursor-pointer hover:scale-110 transition-transform" style="perspective: 1000px;">
       ðŸª™
      </div>
     </div><!-- Result Display -->
     <div id="result-container" class="hidden text-center mb-6">
      <div id="result-icon" class="text-6xl mb-4 result-reveal"></div>
      <div id="result-text" class="terminal-text text-2xl font-bold mb-2"></div>
      <div id="result-subtitle" class="terminal-text text-green-400/70"></div>
     </div><!-- Buttons -->
     <div id="buttons" class="flex flex-wrap justify-center gap-3"><button onclick="startGame()" class="btn-matrix px-8 py-3 rounded-full font-bold text-black transition-all duration-300" style="font-family: 'Orbitron', monospace; background: linear-gradient(135deg, #00ff41 0%, #00cc33 100%);"> INITIALIZE </button>
     </div><!-- Footer -->
     <div class="mt-6 text-center">
      <div class="terminal-text text-green-500/40 text-xs">
       â–¸ SWIPE OR CLICK TO INTERACT â—‚
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "DECISION MATRIX",
      player_name: "Agent",
      background_color: "#0a0a0a",
      primary_color: "#00ff41",
      text_color: "#e0ffe0",
      accent_color: "#00cc33",
      surface_color: "#0d1f0d"
    };

    let config = { ...defaultConfig };

    const steps = [
      {
        q: "Does this request involve currency transfer?",
        icon: "ðŸ’°",
        note: "SYSTEM: Financial implications have been noted and filed under 'acceptable losses'.",
        buttons: ["AFFIRMATIVE", "NEGATIVE"],
        points: [10, 5]
      },
      {
        q: "Calculate realistic cost impact:",
        icon: "ðŸ“Š",
        note: "PROTOCOL: Cost analysis shows negligible impact on quarterly projections.",
        buttons: ["$0", "< $20", "> $20"],
        points: [15, 10, 5]
      },
      {
        q: "Is this a simple task or favor?",
        icon: "ðŸŽ¯",
        note: "INSIGHT: Time spent debating exceeds task completion time by 347%.",
        buttons: ["CONFIRMED", "UNCERTAIN"],
        points: [20, 10]
      },
      {
        q: "Do you possess the capability to execute?",
        icon: "âš¡",
        note: "REMINDER: 'Unwillingness' and 'inability' are distinct parameters.",
        buttons: ["CAPABLE", "THEORETICALLY"],
        points: [25, 15]
      },
      {
        q: "FINAL PROTOCOL: Quantum Coin Flip",
        icon: "ðŸŽ²",
        note: "ENTROPY: Randomization eliminates cognitive bias and responsibility.",
        buttons: ["ENGAGE QUANTUM FLIP"],
        points: [0]
      }
    ];

    let currentStep = -1;
    let score = 0;
    let countdown = 15;
    let timerInterval = null;
    let matrixInterval = null;

    function initMatrixRain() {
      const container = document.getElementById('matrix-rain');
      container.innerHTML = '';
      
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()';
      const columns = Math.floor(window.innerWidth / 20);
      
      for (let i = 0; i < columns; i++) {
        const char = document.createElement('span');
        char.className = 'matrix-char';
        char.style.left = `${i * 20}px`;
        char.style.animationDuration = `${3 + Math.random() * 5}s`;
        char.style.animationDelay = `${Math.random() * 3}s`;
        char.textContent = chars[Math.floor(Math.random() * chars.length)];
        char.style.color = config.primary_color;
        char.style.textShadow = `0 0 10px ${config.primary_color}`;
        container.appendChild(char);
      }
      
      if (matrixInterval) clearInterval(matrixInterval);
      matrixInterval = setInterval(() => {
        const matrixChars = container.querySelectorAll('.matrix-char');
        matrixChars.forEach(el => {
          if (Math.random() > 0.95) {
            el.textContent = chars[Math.floor(Math.random() * chars.length)];
          }
        });
      }, 100);
    }

    function updateScore(points) {
      score += points;
      const scoreEl = document.getElementById('score');
      scoreEl.textContent = score;
      scoreEl.classList.add('bump');
      setTimeout(() => scoreEl.classList.remove('bump'), 300);
    }

    function updateProgress() {
      const progress = ((currentStep + 1) / steps.length) * 100;
      document.getElementById('progress-bar').style.width = `${progress}%`;
      document.getElementById('progress-text').textContent = `${currentStep + 1}/${steps.length}`;
    }

    function startTimer() {
      countdown = 15;
      document.getElementById('timer-container').classList.remove('hidden');
      document.getElementById('timer-text').textContent = countdown;
      document.getElementById('timer-bar').style.width = '100%';
      
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        countdown--;
        document.getElementById('timer-text').textContent = countdown;
        document.getElementById('timer-bar').style.width = `${(countdown / 15) * 100}%`;
        
        if (countdown <= 5) {
          document.getElementById('timer-text').classList.add('text-red-400');
          document.getElementById('timer-bar').classList.remove('from-yellow-600', 'to-yellow-400');
          document.getElementById('timer-bar').classList.add('from-red-600', 'to-red-400');
        }
        
        if (countdown <= 0) {
          clearInterval(timerInterval);
          autoAdvance();
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) clearInterval(timerInterval);
      document.getElementById('timer-container').classList.add('hidden');
      document.getElementById('timer-text').classList.remove('text-red-400');
      document.getElementById('timer-bar').classList.add('from-yellow-600', 'to-yellow-400');
      document.getElementById('timer-bar').classList.remove('from-red-600', 'to-red-400');
    }

    function autoAdvance() {
      if (currentStep < steps.length - 1) {
        const step = steps[currentStep];
        updateScore(step.points[step.points.length - 1]);
        nextStep();
      }
    }

    function startGame() {
      currentStep = -1;
      score = 0;
      document.getElementById('score').textContent = '0';
      document.getElementById('result-container').classList.add('hidden');
      document.getElementById('coin-container').classList.add('hidden');
      nextStep();
    }

    function nextStep() {
      currentStep++;
      stopTimer();
      
      if (currentStep >= steps.length) {
        showFinalResult();
        return;
      }
      
      updateProgress();
      const step = steps[currentStep];
      
      document.getElementById('question-icon').textContent = step.icon;
      document.getElementById('question-text').textContent = step.q;
      document.getElementById('question-area').classList.remove('hidden');
      
      document.getElementById('note-text').textContent = step.note;
      document.getElementById('note-container').classList.remove('hidden');
      
      const buttonsContainer = document.getElementById('buttons');
      buttonsContainer.innerHTML = '';
      
      if (currentStep === steps.length - 1) {
        document.getElementById('coin-container').classList.remove('hidden');
        const coinBtn = document.createElement('button');
        coinBtn.className = 'btn-matrix px-8 py-3 rounded-full font-bold text-black transition-all duration-300';
        coinBtn.style.fontFamily = "'Orbitron', monospace";
        coinBtn.style.background = `linear-gradient(135deg, ${config.primary_color} 0%, ${config.accent_color} 100%)`;
        coinBtn.textContent = step.buttons[0];
        coinBtn.onclick = flipCoin;
        buttonsContainer.appendChild(coinBtn);
      } else {
        step.buttons.forEach((label, idx) => {
          const btn = document.createElement('button');
          btn.className = 'btn-matrix px-6 py-3 rounded-full font-bold text-black transition-all duration-300';
          btn.style.fontFamily = "'Orbitron', monospace";
          btn.style.background = `linear-gradient(135deg, ${config.primary_color} 0%, ${config.accent_color} 100%)`;
          btn.textContent = label;
          btn.onclick = () => handleChoice(idx);
          buttonsContainer.appendChild(btn);
        });
        startTimer();
      }
    }

    function handleChoice(idx) {
      const step = steps[currentStep];
      updateScore(step.points[idx]);
      nextStep();
    }

    function flipCoin() {
      stopTimer();
      document.getElementById('buttons').innerHTML = '';
      
      const coin = document.getElementById('coin');
      coin.classList.add('coin-flip');
      
      setTimeout(() => {
        coin.classList.remove('coin-flip');
        const result = Math.random() > 0.5;
        updateScore(result ? 50 : 25);
        
        document.getElementById('coin-container').classList.add('hidden');
        showFinalResult(result);
      }, 1500);
    }

    function showFinalResult(coinResult) {
      document.getElementById('question-area').classList.add('hidden');
      document.getElementById('note-container').classList.add('hidden');
      document.getElementById('coin-container').classList.add('hidden');
      
      const resultContainer = document.getElementById('result-container');
      resultContainer.classList.remove('hidden');
      
      let icon, text, subtitle;
      
      if (coinResult !== undefined) {
        if (coinResult) {
          icon = 'âœ…';
          text = 'REQUEST APPROVED';
          subtitle = 'The matrix has spoken. Compliance is mandatory.';
        } else {
          icon = 'â³';
          text = 'REQUEST PENDING';
          subtitle = 'Resubmit in 24 hours for quantum recalculation.';
        }
      } else {
        icon = 'ðŸ†';
        text = 'EVALUATION COMPLETE';
        subtitle = `Final Score: ${score} neural points`;
      }
      
      document.getElementById('result-icon').textContent = icon;
      document.getElementById('result-text').textContent = text;
      document.getElementById('result-text').style.color = config.primary_color;
      document.getElementById('result-subtitle').textContent = subtitle;
      
      const buttonsContainer = document.getElementById('buttons');
      buttonsContainer.innerHTML = '';
      
      const restartBtn = document.createElement('button');
      restartBtn.className = 'btn-matrix px-8 py-3 rounded-full font-bold text-black transition-all duration-300';
      restartBtn.style.fontFamily = "'Orbitron', monospace";
      restartBtn.style.background = `linear-gradient(135deg, ${config.primary_color} 0%, ${config.accent_color} 100%)`;
      restartBtn.textContent = 'REINITIALIZE';
      restartBtn.onclick = startGame;
      buttonsContainer.appendChild(restartBtn);
    }

    function applyConfig(cfg) {
      document.getElementById('title').textContent = cfg.game_title || defaultConfig.game_title;
      document.getElementById('title').style.color = cfg.primary_color || defaultConfig.primary_color;
      document.getElementById('title').style.textShadow = `0 0 20px ${cfg.primary_color || defaultConfig.primary_color}`;
      
      const playerName = cfg.player_name || defaultConfig.player_name;
      document.getElementById('player-name').textContent = playerName;
      document.getElementById('player-initial').textContent = playerName.charAt(0).toUpperCase();
      
      const container = document.getElementById('app-container');
      container.style.background = `linear-gradient(135deg, ${cfg.background_color || defaultConfig.background_color} 0%, ${cfg.surface_color || defaultConfig.surface_color} 50%, ${cfg.background_color || defaultConfig.background_color} 100%)`;
      
      const buttons = document.querySelectorAll('.btn-matrix');
      buttons.forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${cfg.primary_color || defaultConfig.primary_color} 0%, ${cfg.accent_color || defaultConfig.accent_color} 100%)`;
      });
      
      initMatrixRain();
    }

    async function initApp() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (cfg) => {
            config = { ...defaultConfig, ...cfg };
            applyConfig(config);
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
              },
              {
                get: () => cfg.primary_color || defaultConfig.primary_color,
                set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
              },
              {
                get: () => cfg.accent_color || defaultConfig.accent_color,
                set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ["game_title", cfg.game_title || defaultConfig.game_title],
            ["player_name", cfg.player_name || defaultConfig.player_name]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }
      
      applyConfig(config);
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c3766f6929566d1',t:'MTc2OTM0MDI0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
